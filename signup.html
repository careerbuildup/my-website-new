<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Account - IT Collaboration</title>
    <link rel="stylesheet" href="signup-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <div class="signup-wrapper">
        <div class="signup-container">
            <h2>Create Your Account</h2>
            
            <form id="signup-form" action="#">
                <div class="name-group">
                    <div class="input-group">
                        <i class="fas fa-user"></i>
                        <input type="text" id="fname" placeholder="First Name" required>
                    </div>
                    <div class="input-group">
                        <i class="fas fa-user"></i>
                        <input type="text" id="lname" placeholder="Last Name" required>
                    </div>
                </div>
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" id="email-signup" placeholder="Email Address" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-user-circle"></i>
                    <input type="text" id="username" placeholder="Username" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="pass-signup" placeholder="Password" required>
                    <span class="toggle-password">
                        <i class="fas fa-eye-slash"></i>
                    </span>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="repass-signup" placeholder="Retype Password" required>
                    <span class="toggle-password">
                        <i class="fas fa-eye-slash"></i>
                    </span>
                </div>
                <div class="terms-group">
                    <label class="agree-terms">
                        <input type="checkbox" id="terms-check" class="checkbox">
                        I agree to the <a href="#">Terms & Conditions</a>
                    </label>
                </div>
                <button type="submit" class="signup-btn">Sign Up</button>
            </form>
            
            <p class="login-link">
                Already have an account? <a href="login.html">Sign In</a>
            </p>
        </div>
        <a href="index.html" class="back-to-home">&larr; Back to Home</a>
    </div>

    <!-- UI Script for Toggle Password -->
    <script>
    const togglePasswordIcons = document.querySelectorAll('.toggle-password');

    togglePasswordIcons.forEach(icon => {
        icon.addEventListener('click', () => {
            const passwordInput = icon.previousElementSibling;
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.innerHTML = '<i class="fas fa-eye"></i>';
            } else {
                passwordInput.type = 'password';
                icon.innerHTML = '<i class="fas fa-eye-slash"></i>';
            }
        });
    });
    </script>

    <!-- Firebase Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBHV3LF6IVV9j6Mbj45alh7ZM1umTt5T_s",
            authDomain: "it-collaboration-bd-d9d49.firebaseapp.com",
            projectId: "it-collaboration-bd-d9d49",
            storageBucket: "it-collaboration-bd-d9d49.firebasestorage.app",
            messagingSenderId: "620180048968",
            appId: "1:620180048968:web:a020267d4250e50a091c7d",
            measurementId: "G-MD3WBCZVLT"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Sign Up Event Listener
        document.getElementById('signup-form').addEventListener('submit', async (e) => {
            e.preventDefault(); // পেজ রিলোড বন্ধ করা

            // ইনপুট ভ্যালু নেওয়া
            const fname = document.getElementById('fname').value;
            const lname = document.getElementById('lname').value;
            const email = document.getElementById('email-signup').value;
            const username = document.getElementById('username').value;
            const password = document.getElementById('pass-signup').value;
            const repassword = document.getElementById('repass-signup').value;
            const terms = document.getElementById('terms-check').checked;

            // পাসওয়ার্ড ম্যাচিং চেক
            if (password !== repassword) {
                alert("Passwords do not match! (পাসওয়ার্ড মিলছে না)");
                return;
            }

            // পাসওয়ার্ড লেংথ চেক (Firebase এর জন্য অন্তত ৬ সংখ্যা লাগে)
            if (password.length < 6) {
                alert("Password must be at least 6 characters long.");
                return;
            }

            // টার্মস চেকবক্স চেক
            if (!terms) {
                alert("Please agree to the Terms & Conditions first.");
                return;
            }

            try {
                // ১. ফায়ারবেসে ইউজার তৈরি করা
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // ২. ইউজারের ডিসপ্লে নাম আপডেট করা
                await updateProfile(user, {
                    displayName: fname + " " + lname
                });

                // ৩. অতিরিক্ত তথ্য ডাটাবেসে সেভ করা (Firestore)
                await setDoc(doc(db, "users", user.uid), {
                    firstName: fname,
                    lastName: lname,
                    username: username,
                    email: email,
                    uid: user.uid,
                    createdAt: new Date()
                });

                // ৪. সফল হলে মেসেজ এবং রিডাইরেক্ট
                alert("Account created successfully! Redirecting to Login page...\n (ইমেইল এবং পাসওয়ার্ড রিসেট করতে পারবেন না) \n (তাই একবার ব্যবহার করলে অবশ্যই সেটি মনে রাখবেন) \n (প্রয়োজনে whatsapp এ মেসেজ দিন) \n (লগইন বাটন এ ক্লিক করে লগইন পেজ এ লগইন করুন)");
                
                // লগইন পেজে নিয়ে যাওয়া
                window.location.replace("login.html");

            } catch (error) {
                // ৫. এরর হ্যান্ডলিং (Error Handling)
                const errorCode = error.code;
                
                if (errorCode === 'auth/email-already-in-use') {
                    alert("This email is already in use. Please use a different email or Log in.\n(এই ইমেইল দিয়ে ইতিমধ্যে একাউন্ট খোলা আছে।)\n (লগইন করুন)");
                } else if (errorCode === 'auth/invalid-email') {
                    alert("Invalid Email Address.\n(ইমেইল এড্রেসটি সঠিক নয়।)");
                } else if (errorCode === 'auth/weak-password') {
                    alert("Password is too weak.\n(পাসওয়ার্ডটি খুব দুর্বল, অন্তত ৬ সংখ্যার দিন।)");
                } else {
                    // অন্য কোনো সমস্যা হলে
                    alert("Error: " + error.message);
                }
                console.error("Firebase Error:", error);
            }
        });
    </script>
</body>
</html>